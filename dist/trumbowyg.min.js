/** Trumbowyg v1.1.7 - A lightweight WYSIWYG editor - alex-d.github.io/Trumbowyg - License MIT - Author : Alexandre Demode (Alex-D) / alex-d.fr */
jQuery.trumbowyg={langs:{en:{viewHTML:"View HTML",formatting:"Formatting",p:"Paragraph",blockquote:"Quote",code:"Code",header:"Header",bold:"Bold",italic:"Italic",strikethrough:"Stroke",underline:"Underline",strong:"Strong",em:"Emphasis",del:"Deleted",unorderedList:"Unordered list",orderedList:"Ordered list",insertImage:"Insert Image",insertVideo:"Insert Video",link:"Link",createLink:"Insert link",unlink:"Remove link",justifyLeft:"Align Left",justifyCenter:"Align Center",justifyRight:"Align Right",justifyFull:"Align Justify",horizontalRule:"Insert horizontal rule",fullscreen:"fullscreen",close:"Close",submit:"Confirm",reset:"Cancel",invalidUrl:"Invalid URL",required:"Required",description:"Description",title:"Title",text:"Text",width:"Width",align:"Align",none:"None",left:"Left",center:"Center",right:"Right"}},opts:{},btnsGrps:{design:["bold","italic","underline","strikethrough"],semantic:["strong","em","del"],justify:["justifyLeft","justifyCenter","justifyRight","justifyFull"],lists:["unorderedList","orderedList"]}},function(e,t,n,i){"use strict";n.fn.trumbowyg=function(e,t){if(e===Object(e)||!e)return this.each(function(){n(this).data("trumbowyg")||n(this).data("trumbowyg",new o(this,e))});if(1===this.length)try{var i=n(this).data("trumbowyg");switch(e){case"openModal":return i.openModal(t.title,t.content);case"closeModal":return i.closeModal();case"openModalInsert":return i.openModalInsert(t.title,t.fields,t.callback);case"saveSelection":return i.saveSelection();case"getSelection":return i.selection;case"getSelectedText":return i.selection+"";case"restoreSelection":return i.restoreSelection();case"destroy":return i.destroy();case"empty":return i.empty();case"lang":return i.lang;case"duration":return i.o.duration;case"html":return i.html(t)}}catch(r){}return!1};var o=function(e,i){var o=this;o.doc=e.ownerDocument||t,o.$e=n(e),o.$creator=n(e),i=n.extend(!0,{},i,n.trumbowyg.opts),"undefined"==typeof i.lang||"undefined"==typeof n.trumbowyg.langs[i.lang]?o.lang=n.trumbowyg.langs.en:o.lang=n.extend(!0,{},n.trumbowyg.langs.en,n.trumbowyg.langs[i.lang]),o.o=n.extend(!0,{},{lang:"en",dir:"ltr",duration:200,mobile:!1,tablet:!0,closable:!1,fullscreenable:!0,fixedBtnPane:!1,fixedFullWidth:!1,autogrow:!1,prefix:"trumbowyg-",convertLink:!0,semantic:!1,resetCss:!1,btns:["viewHTML","|","formatting","|",n.trumbowyg.btnsGrps.design,"|","link","|","insertImage","|",n.trumbowyg.btnsGrps.justify,"|",n.trumbowyg.btnsGrps.lists,"|","horizontalRule"],btnsAdd:[],btnsDef:{viewHTML:{func:"toggle"},p:{func:"formatBlock"},blockquote:{func:"formatBlock"},h1:{func:"formatBlock",title:o.lang.header+" 1"},h2:{func:"formatBlock",title:o.lang.header+" 2"},h3:{func:"formatBlock",title:o.lang.header+" 3"},h4:{func:"formatBlock",title:o.lang.header+" 4"},bold:{},italic:{},underline:{},strikethrough:{},strong:{func:"bold"},em:{func:"italic"},del:{func:"strikethrough"},createLink:{},unlink:{},insertImage:{},justifyLeft:{},justifyCenter:{},justifyRight:{},justifyFull:{},unorderedList:{func:"insertUnorderedList"},orderedList:{func:"insertOrderedList"},horizontalRule:{func:"insertHorizontalRule"},formatting:{dropdown:["p","blockquote","h1","h2","h3","h4"]},link:{dropdown:["createLink","unlink"]}},removeEmbeds:function(){}},i),o.o.semantic&&!i.btns?o.o.btns=["viewHTML","|","formatting","|",n.trumbowyg.btnsGrps.semantic,"|","link","|","insertImage","|",n.trumbowyg.btnsGrps.justify,"|",n.trumbowyg.btnsGrps.lists,"|","horizontalRule"]:i&&i.btns&&(o.o.btns=i.btns),o.embedIds=[],o.init()};o.prototype={init:function(){var e=this;return e.height=e.$e.css("height"),e.isEnabled()?void e.buildEditor(!0):(e.buildEditor(),e.buildBtnPane(),e.fixedBtnPaneEvents(),void e.buildOverlay())},buildEditor:function(e){var t=this,i=t.o.prefix,o="";if(e!==!0)t.$box=n("<div/>",{"class":i+"box "+i+t.o.lang+" trumbowyg"}),t.isTextarea=!0,t.$e.is("textarea")?t.$editor=n("<div/>"):(t.$editor=t.$e,t.$e=t.buildTextarea().val(t.$e.val()),t.isTextarea=!1),t.$creator.is("[placeholder]")&&t.$editor.attr("placeholder",t.$creator.attr("placeholder")),t.$e.hide().addClass(i+"textarea"),t.isTextarea?(o=t.$e.val(),t.$box.insertAfter(t.$e).append(t.$editor).append(t.$e)):(o=t.$editor.html(),t.$box.insertAfter(t.$editor).append(t.$e).append(t.$editor),t.syncCode()),t.$editor.addClass(i+"editor").attr("contenteditable",!0).attr("dir",t.lang._dir||t.o.dir).html(o),t.o.resetCss&&t.$editor.addClass(i+"reset-css"),t.o.autogrow||n.each([t.$editor,t.$e],function(e,n){n.css({height:t.height,overflow:"auto"})}),t.o.semantic&&(t.$editor.html(t.$editor.html().replace("<br>","</p><p>").replace("&nbsp;","")),t.semanticCode()),t.$editor.on("dblclick","img",function(e){var i=n(this);t.openModalInsert(t.lang.insertImage,{url:{label:"URL",value:i.attr("src"),required:!0},alt:{label:"description",value:i.attr("alt")},width:{label:"width",type:"number",value:i.attr("width")},align:{align:"align",type:"radio",value:i.attr("align")}},function(e){return i.attr({src:e.url,alt:e.alt,width:e.width,align:e.align}).css({width:e.width+"px"}),!0}),e.stopPropagation()}).on("keyup",function(e){t.semanticCode(!1,13===e.which)}).on("focus",function(){t.$creator.trigger("tbwfocus")}).on("blur",function(){t.syncCode(),t.$creator.trigger("tbwblur")});else if(!t.$e.is("textarea")){var r=t.buildTextarea().val(t.$e.val());t.$e.hide().after(r)}},buildTextarea:function(){return n("<textarea/>",{name:this.$e.attr("id"),height:this.height})},buildBtnPane:function(){var t=this,o=t.o.prefix;if(t.o.btns!==!1){t.$btnPane=n("<ul/>",{"class":o+"button-pane"}),n.each(t.o.btns.concat(t.o.btnsAdd),function(e,r){try{var a=r.split("btnGrp-");a[1]!==i&&(r=n.trumbowyg.btnsGrps[a[1]])}catch(s){}n.isArray(r)||(r=[r]),n.each(r,function(e,i){try{var r=n("<li/>");"|"===i?r.addClass(o+"separator"):t.isSupportedBtn(i)&&r.append(t.buildBtn(i)),t.$btnPane.append(r)}catch(a){}})});var r=n("<li/>",{"class":o+"not-disable "+o+"buttons-right"});t.o.fullscreenable&&r.append(t.buildRightBtn("fullscreen").on("click",function(){var i=o+"fullscreen";t.$box.toggleClass(i),t.$box.hasClass(i)?(n("body").css("overflow","hidden"),n.each([t.$editor,t.$e],function(){n(this).css({height:"calc(100% - 35px)",overflow:"auto"})}),t.$btnPane.css("width","100%")):(n("body").css("overflow","auto"),t.$box.removeAttr("style"),t.o.autogrow||n.each([t.$editor,t.$e],function(){n(this).css("height",t.height)})),n(e).trigger("scroll")})),t.o.closable&&r.append(t.buildRightBtn("close").on("click",function(){t.$box.hasClass(o+"fullscreen")&&n("body").css("overflow","auto"),t.destroy()})),r.not(":empty")&&t.$btnPane.append(r),t.$box.prepend(t.$btnPane)}},buildBtn:function(e){var t=this,i=t.o.prefix,o=t.o.btnsDef[e],r=o.dropdown,a=t.lang[e]||e,s=n("<button/>",{type:"button","class":i+e+"-button"+(o.ico?" "+i+o.ico+"-button":""),text:o.text||o.title||a,title:o.title||o.text||a,mousedown:function(a){return(!r||t.$box.find("."+e+"-"+i+"dropdown").is(":hidden"))&&n("body",t.doc).trigger("mousedown"),!t.$btnPane.hasClass(i+"disable")||n(this).hasClass(i+"active")||n(this).parent().hasClass(i+"not-disable")?(t.execCmd((r?"dropdown":!1)||o.func||e,o.param||e),a.stopPropagation(),void a.preventDefault()):!1}});if(r){s.addClass(i+"open-dropdown");var l=i+"dropdown",d=n("<div/>",{"class":e+"-"+l+" "+l+" "+i+"fixed-top"});n.each(r,function(e,n){t.o.btnsDef[n]&&t.isSupportedBtn(n)&&d.append(t.buildSubBtn(n))}),t.$box.append(d.hide())}return s},buildSubBtn:function(e){var t=this,i=t.o.btnsDef[e];return n("<button/>",{type:"button",text:i.text||i.title||t.lang[e]||e,style:i.style||null,mousedown:function(o){n("body",t.doc).trigger("mousedown"),t.execCmd(i.func||e,i.param||e),o.stopPropagation()}})},buildRightBtn:function(e){return n("<button/>",{type:"button","class":this.o.prefix+e+"-button",title:this.lang[e],text:this.lang[e]})},isSupportedBtn:function(e){var t=this.o.btnsDef[e];return"function"!=typeof t.isSupported||t.isSupported()},buildOverlay:function(){var e=this;return e.$overlay=n("<div/>",{"class":e.o.prefix+"overlay"}).css({top:e.$btnPane.outerHeight(),height:parseInt(e.$editor.outerHeight())+1+"px"}).appendTo(e.$box),e.$overlay},showOverlay:function(){var t=this;n(e).trigger("scroll"),t.$overlay.fadeIn(t.o.duration),t.$box.addClass(t.o.prefix+"box-blur")},hideOverlay:function(){var e=this;e.$overlay.fadeOut(e.o.duration/4),e.$box.removeClass(e.o.prefix+"box-blur")},fixedBtnPaneEvents:function(){var t=this,i=t.o.fixedFullWidth;t.o.fixedBtnPane&&(t.isFixed=!1,n(e).on("scroll resize",function(){if(t.$box){t.syncCode();var o=n(e).scrollTop(),r=t.$box.offset().top+1,a=o-r>0&&o-r-parseInt(t.height)<0,s=t.$btnPane,l=s.css("height"),d=s.outerHeight();a?(t.isFixed||(t.isFixed=!0,s.css({position:"fixed",top:0,left:i?"0":"auto",zIndex:7}),n([t.$editor,t.$e]).css({marginTop:l})),s.css({width:i?"100%":parseInt(t.$box.css("width"))-1+"px"}),n("."+t.o.prefix+"fixed-top",t.$box).css({position:i?"fixed":"absolute",top:i?d:parseInt(d)+(o-r)+"px",zIndex:15})):t.isFixed&&(t.isFixed=!1,s.removeAttr("style"),n([t.$editor,t.$e]).css({marginTop:0}),n("."+t.o.prefix+"fixed-top",t.$box).css({position:"absolute",top:d}))}}))},destroy:function(){var e=this,t=e.o.prefix,n=e.height,i=e.html();e.isTextarea?e.$box.after(e.$e.css({height:n}).val(i).removeClass(t+"textarea").show()):e.$box.after(e.$editor.css({height:n}).removeClass(t+"editor").removeAttr("contenteditable").html(i).show()),e.$box.remove(),e.$creator.removeData("trumbowyg")},empty:function(){this.$e.val(""),this.syncCode(!0)},toggle:function(){var e=this,t=e.o.prefix;e.semanticCode(!1,!0),e.$editor.toggle(),e.$e.toggle(),e.$btnPane.toggleClass(t+"disable"),e.$btnPane.find("."+t+"viewHTML-button").toggleClass(t+"active")},dropdown:function(t){var i=this,o=i.doc,r=i.o.prefix,a=i.$box.find("."+t+"-"+r+"dropdown"),s=i.$btnPane.find("."+r+t+"-button");if(a.is(":hidden")){var l=s.offset().left;s.addClass(r+"active"),a.css({position:"absolute",top:i.$btnPane.outerHeight(),left:i.o.fixedFullWidth&&i.isFixed?l+"px":l-i.$btnPane.offset().left+"px"}).show(),n(e).trigger("scroll"),n("body",o).on("mousedown",function(){n("."+r+"dropdown",o).hide(),n("."+r+"active",o).removeClass(r+"active"),n("body",o).off("mousedown")})}else n("body",o).trigger("mousedown")},html:function(e){var t=this;return e?(t.$e.val(e),t.syncCode(!0),t):t.$e.val()},syncCode:function(e){var t=this;!e&&t.$editor.is(":visible")?t.$e.val(t.$editor.html()):t.$editor.html(t.$e.val()),t.o.autogrow&&(t.height=t.$editor.css("height"),t.$e.css({height:t.height})),t.checkEmbeds()},checkEmbeds:function(){var e=this,t=[];e.$editor.find("*[data-embed-imageid]").each(function(){t.push(n(this).data("embed-imageid"))});for(var i=0;i<e.embedIds.length;i++)t.indexOf(e.embedIds[i])<0&&e.o.removeEmbeds(e.embedIds[i]);e.embedIds=n.unique(t)},semanticCode:function(e,t){var i=this;i.syncCode(e),i.o.semantic&&(i.semanticTag("b","strong"),i.semanticTag("i","em"),i.semanticTag("strike","del"),t&&(i.$editor.contents().filter(function(){return 3===this.nodeType&&n.trim(this.nodeValue).length>0}).wrap("<p></p>").end().filter("br").remove(),i.saveSelection(),i.semanticTag("div","p"),i.restoreSelection()),i.$e.val(i.$editor.html()))},semanticTag:function(e,t){n(e,this.$editor).each(function(){n(this).replaceWith(function(){return"<"+t+">"+n(this).html()+"</"+t+">"})})},createLink:function(){var e=this;e.saveSelection(),e.openModalInsert(e.lang.createLink,{url:{label:"URL",value:"http://",required:!0},title:{label:e.lang.title,value:e.selection},text:{label:e.lang.text,value:e.selection}},function(t){e.execCmd("createLink",t.url);var i=n('a[href="'+t.url+'"]:not([title])',e.$box);return t.text.length>0&&i.text(t.text),t.title.length>0&&i.attr("title",t.title),!0})},insertImage:function(){var e=this;e.saveSelection(),e.openModalInsert(e.lang.insertImage,{url:{label:"URL",value:"http://",required:!0},alt:{label:e.lang.description,value:e.selection}},function(t){return e.execCmd("insertImage",t.url),n('img[src="'+t.url+'"]:not([alt])',e.$box).attr("alt",t.alt),!0})},insertVideo:function(){var e=this;e.saveSelection(),e.openModalInsert(e.lang.insertVideo,{url:{label:"URL",value:"http://",required:!0},alt:{label:e.lang.description,value:e.selection}},function(t){return e.execCmd("insertVideo",t.url),n('video[src="'+t.url+'"]:not([alt])',e.$box).attr("alt",t.alt),!0})},execCmd:function(i,o,r){var a=this;"dropdown"!=i&&a.$editor.focus();try{a[i](o)}catch(s){try{i(o,a)}catch(l){if("insertHorizontalRule"==i)o=null;else if("formatBlock"==i&&(-1!==navigator.userAgent.indexOf("MSIE")||navigator.appVersion.indexOf("Trident/")>0))o="<"+o+">";else if("insertImage"==i){r=r||{id:""};var d=t.queryCommandSupported("insertHTML");if(!d){var c=e.getSelection(),u=c.getRangeAt(0),f=t.createDocumentFragment(),p=t.createElement("img");return n(p).attr({src:o,"data-embed-imageid":r.id}),f.appendChild(p),u.insertNode(f),void a.syncCode()}i="insertHTML",o="<img src="+o+" data-embed-imageID="+r.id+">"}else if("insertVideo"==i){var d=t.queryCommandSupported("insertHTML");if(!d){var c=e.getSelection(),u=c.getRangeAt(0),f=t.createDocumentFragment(),h=t.createElement("video");return n(h).attr({controls:!0,src:o}),f.appendChild(h),u.insertNode(f),void a.syncCode()}i="insertHTML",o=qollapVars.vid_convert_img_url?"<video controls src="+o+' poster="'+qollapVars.vid_convert_img_url+'"></video>':"<video controls src="+o+"></video>"}a.doc.execCommand(i,!1,o)}}a.syncCode()},openModal:function(t,i){var o=this,r=o.o.prefix;if(n("."+r+"modal-box",o.$box).size()>0)return!1;o.saveSelection(),o.showOverlay(),o.$btnPane.addClass(r+"disable");var a=n("<div/>",{"class":r+"modal "+r+"fixed-top"}).css({top:parseInt(o.$btnPane.css("height"))+1+"px"}).appendTo(o.$box);o.$overlay.one("click",function(e){e.preventDefault(),a.trigger(r+"cancel")});var s=n("<form/>",{action:"",html:i}).on("submit",function(e){e.preventDefault(),a.trigger(r+"confirm")}).on("reset",function(e){e.preventDefault(),a.trigger(r+"cancel")}),l=n("<div/>",{"class":r+"modal-box",html:s}).css({top:"-"+parseInt(o.$btnPane.outerHeight())+"px",opacity:0}).appendTo(a).animate({top:0,opacity:1},o.o.duration/2);return n("<span/>",{text:t,"class":r+"modal-title"}).prependTo(l),l.find("input:first").focus(),o.buildModalBtn("submit",l),o.buildModalBtn("reset",l),n(e).trigger("scroll"),a},buildModalBtn:function(e,t){var i=this,o=i.o.prefix;return n("<button/>",{"class":o+"modal-button "+o+"modal-"+e,type:e,text:i.lang[e]||e}).appendTo(t.find("form"))},closeModal:function(){var e=this,t=e.o.prefix;e.$btnPane.removeClass(t+"disable"),e.$overlay.off();var i=n("."+t+"modal-box",e.$box),o=i.find('button[type="submit"]');o.prop("disabled",!1),i.animate({top:"-"+i.css("height")},e.o.duration/2,function(){n(this).parent().remove(),e.hideOverlay()})},openModalInsert:function(e,o,r){var a=this,s=a.o.prefix,l=a.lang,d="";for(var c in o){var u=o[c],f=u.label===i?l[c]?l[c]:c:l[u.label]?l[u.label]:u.label;if(u.name===i&&(u.name=c),u.pattern||"url"!==c||(u.pattern=/^(http|https):\/\/([\w~#!:.?+=&%@!\-\/]+)$/,u.patternError=l.invalidUrl),"radio"===u.type){var p="",h=[l.none,l.left,l.center,l.right];n.each(h,function(e,t){var n=u.value==t?"checked":"";p+='<label class="aligns__align"><input type="radio" name="align-choice" value="'+t+'"'+n+">"+t+"</label>"}),d+='<div class="label"><div class="aligns">'+p+'</div><span class="'+s+'input-infos"><span>'+f+"</span></span></div>",d+='<input id="align" type="hidden" name="'+u.name+'" value="'+(u.value||"")+'">',n(t).on("change",".aligns__align input",function(){if(n(this).is(":checked")){var e=n(this).val();n("#align").val(e)}})}else d+='<label><input type="'+(u.type||"text")+'" name="'+u.name+'" value="'+(u.value||"")+'"><span class="'+s+'input-infos"><span>'+f+"</span></span></label>"}return a.openModal(e,d).on(s+"confirm",function(){var e=n(this).find("form"),t=n(this).find('button[type="submit"]'),i=!0,l={};t.prop("disabled",!0);for(var d in o){var c=n('input[name="'+d+'"]',e);l[d]=n.trim(c.val()),o[d].required&&""===l[d]?(t.prop("disabled",!1),i=!1,a.addErrorOnModalField(c,a.lang.required)):o[d].pattern&&!o[d].pattern.test(l[d])&&(t.prop("disabled",!1),i=!1,a.addErrorOnModalField(c,o[d].patternError))}i&&(a.restoreSelection(),r(l,o)&&(a.syncCode(),a.closeModal(),n(this).off(s+"confirm")))}).one(s+"cancel",function(){n(this).off(s+"confirm"),a.closeModal(),a.restoreSelection()})},addErrorOnModalField:function(e,t){var i=this.o.prefix,o=e.parent();e.on("change keyup",function(){o.removeClass(i+"input-error")}),o.addClass(i+"input-error").find("input+span").append(n("<span/>",{"class":i+"msg-error",text:t}))},saveSelection:function(){var t=this,n=t.doc;if(t.selection=null,e.getSelection){var i=e.getSelection();i.getRangeAt&&i.rangeCount&&(t.selection=i.getRangeAt(0))}else n.selection&&n.selection.createRange&&(t.selection=n.selection.createRange())},restoreSelection:function(){var t=this,n=t.selection;if(n)if(e.getSelection){var i=e.getSelection();i.removeAllRanges(),i.addRange(n)}else t.doc.selection&&n.select&&n.select()},isEnabled:function(){var e=new RegExp("(iPad|webOS)"),t=new RegExp("(iPhone|iPod|Android|BlackBerry|Windows Phone|ZuneWP7)"),n=navigator.userAgent;return this.o.tablet===!0&&e.test(n)||this.o.mobile===!0&&t.test(n)}}}(window,document,jQuery);